{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center mb-4">Checkout</h1>
    <hr>
    
    <div class="row">
        
        <div class="col-12 col-md-6 order-md-1">
            <div class="order-summary-container p-3 mb-4 border rounded shadow-sm bg-white">
                <h2 class="mb-3">Order Summary</h2>
                
                {% for item in cart_items %}
                <p>
                    {{ item.wine.name }} x {{ item.quantity }} @ £{{ item.wine.price }} = **£{{ item.subtotal|floatformat:2 }}**
                </p>
                {% endfor %}
                
                <div class="my-3"></div> 
                <hr>
                
                <h3 class="mt-3">Grand Total: <span class="float-right">**£{{ total|floatformat:2 }}**</span></h3>
            </div>
            <div>
                     
                <h3 class="mb-3">Payment Information</h3>

                <div id="payment-element" class="mb-3">
                </div>

                <div id="card-errors" role="alert" class="text-danger mb-3"></div>
                
                <hr>

                <button type="submit" id="submit-button" class="btn btn-success btn-lg btn-block mt-3">Complete Purchase</button>
            </div>
        </div>

        <div class="col-12 col-md-6 order-md-2">
            <form method="post" action="{% url 'checkout' %}" id="payment-form" class="p-3 mb-5 border rounded shadow-sm bg-light">
                {% csrf_token %}
                
                <h3 class="mb-3">Shipping Details</h3>
                
                <div class="form-group mb-3">
                    <label for="id_address_line1">Address Line 1*</label>
                    <input type="text" id="id_address_line1" name="address_line1" class="form-control" required>
                </div>
                
                <div class="form-group mb-3">
                    <label for="id_address_line2">Address Line 2</label>
                    <input type="text" id="id_address_line2" name="address_line2" class="form-control">
                </div>
                
                <div class="form-group mb-3">
                    <label for="id_address_line3">Address Line 3</label>
                    <input type="text" id="id_address_line3" name="address_line3" class="form-control">
                </div>

                <div class="form-group mb-3">
                    <label for="id_city">City*</label>
                    <input type="text" id="id_city" name="city" class="form-control" required>
                </div>

                <div class="form-group mb-3">
                    <label for="id_postcode">Post Code*</label>
                    <input type="text" id="id_postcode" name="postcode" class="form-control" required>
                </div>
                
                <div class="form-group mb-4">
                    <label for="id_country">Country*</label>
                    <input type="text" id="id_country" name="country" class="form-control" required>
                </div>

                <div class="form-group mb-4">
                    <label for="id_phone_number">Phone Number*</label>
                    <input type="tel" id="id_phone_number" name="phone_number" class="form-control" required>
                </div>
                
                <hr class="mt-4 mb-4"> 
            </form>
        </div>

    </div>
</div>
{% endblock %}

{% block postloadjs %}
    {{ block.super }}

    {{ stripe_public_key|json_script:"id_stripe_public_key" }}
    {{ client_secret|json_script:"id_client_secret" }}
    
    <script src="{% static 'js/stripe.js' %}"></script>

{% endblock %}